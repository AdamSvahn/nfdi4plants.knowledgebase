---
title: Wrapping a script with CWL
lastUpdated: 2024-11-14
authors:
  - dominik-brilhaus
sidebar:
  order: 4
  badge:
    text: wip
    variant: caution
draft: true
---

import { FileTree } from '@astrojs/starlight/components';
import { Steps } from '@astrojs/starlight/components';
import ViolasARCFinal from '@components/mdx/ViolasARC-final.mdx'

:::note
This builds on the ARC created in the [Start here](/nfdi4plants.knowledgebase/start-here/)

<details>
<summary>Click here to see what the ARC looks like</summary>

<ViolasARCFinal />

</details>

You can also download the ARC (e.g. via [ARCitect](/nfdi4plants.knowledgebase/arcitect)) from the [DataHUB](https://git.nfdi4plants.org/training/AthalianaColdStressSugar).

:::

## Scripts and CWL files

We generate the following three files and place them in the ARC.

<div class="overflow-x-auto">
          <div class="min-w-[800px]" >

File name   | Description                                   | Location in the ARC
---         | ---                                           | ---
`heatmap.py`  | Script used for data analysis | `workflows/heatmap/heatmap.py`
`workflow.cwl`  | CWL document wrapping the `heatmap.py` | `workflows/heatmap/workflow.cwl`
`job.yml`  | Yaml providing the parameters for `workflow.cwl` | `runs/heatmap-run/job.yml`

</div></div>

<details>
<summary>`heatmap.py`</summary>

```python
import pandas as pd
import plotly.express as px
import sys

# Read command line arguments
MeasurementTableCSV=sys.argv[1]
FigureFileName=sys.argv[2]

# Read the CSV file
data = pd.read_csv(MeasurementTableCSV, index_col=0, on_bad_lines='skip')

# Create a heatmap
fig = px.imshow(data, 
                labels=dict(x="Columns", y="Rows", color="Value"),
                x=data.columns, 
                y=data.index)

# Save heatmap to file
fig.write_image(FigureFileName + ".svg")
```

</details>


<details>
<summary>`workflow.cwl`</summary>

```yaml
#!/usr/bin/env cwl-runner

cwlVersion: v1.2
class: CommandLineTool
requirements:
  - class: InitialWorkDirRequirement
    listing:
      - entryname: heatmap.py
        entry:
          $include: heatmap.py
  - class: NetworkAccess
    networkAccess: true
baseCommand: [python3, heatmap.py]
inputs:
  MeasurementTableCSV:
    type: File
    inputBinding:
      position: 1
  FigureFileName:
    type: string
    inputBinding:
      position: 2

outputs:
  output:
    type: File
    outputBinding:
      glob: "*.svg"
```
</details>

<details>
<summary>`job.yml`</summary>

```yaml
MeasurementTableCSV:
    class: File
    path: ../../assays/SugarMeasurement/dataset/sugar_result.csv
FigureFileName: heatmap
```

</details>


## Isolate run parameters and workflow 

<Steps>

1. Add a folder "heatmap" to `workflows`
1. Add the `workflow.cwl` to `workflows/heatmap`
1. Add the `heatmap.py` to `workflows/heatmap`
2. Add a folder "heatmap-run" to `runs` 
2. Add the `job.yml` to `runs/heatmap-run`

</Steps>

<FileTree>
- assays
  - SugarMeasurement
    - dataset
      - **sugar_result.csv**
    - ...
- isa.investigation.xlsx
- runs
    - heatmap-run
        - **job.yml**
- studies
- ...
- workflows
  - heatmap
    - **heatmap.py**
    - **workflow.cwl**
</FileTree>


## Execute the run

